{% extends 'layout/layout.html' %}
{% load static %}
{% block title %}Favourite{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/favourite.css' %}?v={{ timestamp }}">
{% endblock %}

{% block body %}
<div class="content-section">
	{% if locations %}
	<form method="POST" action="{% url 'my_trip' %}">
		{% csrf_token %}
		<h3>Chá»n Ä‘á»‹a Ä‘iá»ƒm:</h3>
		{% for location in locations %}
		<div class="location-block">
			<input type="checkbox" name="locations" value="{{ location.id }}">
			<label>{{ location.location }} ({{ location.coordinate }})</label><br>

			<!-- Check Ä‘á»ƒ chá»n Ä‘iá»ƒm báº¯t Ä‘áº§u vÃ  káº¿t thÃºc -->
			<label>
				<input type="radio" name="start_point" value="{{ location.id }}" onchange="toggleInputs()">Chá»n lÃ m Ä‘iá»ƒm báº¯t Ä‘áº§u
			</label><br>

			<label>
				<input type="radio" name="end_point" value="{{ location.id }}" onchange="toggleInputs()"> Chá»n lÃ m Ä‘iá»ƒm
				káº¿t thÃºc
			</label><br>

			<div id="extra-inputs-{{ location.id }}" class="extra-inputs">
				<label>Ghim vÃ o vá»‹ trÃ­:</label>
				<input type="number" name="pinned_order_{{ location.id }}" min="1" placeholder="Vá»‹ trÃ­ (1,2,3...)"><br>

				<label>Pháº£i Ä‘i sau Ä‘á»‹a Ä‘iá»ƒm ID:</label>
				<input type="number" name="precedence_after_{{ location.id }}"
					placeholder="ID cá»§a Ä‘á»‹a Ä‘iá»ƒm pháº£i Ä‘i sau (optional)">
			</div>

			<hr class="dashed-line">
		</div>
		{% endfor %}

		<h3>TÃªn chuyáº¿n Ä‘i:</h3>
		<input type="text" name="path_name" placeholder="Nháº­p tÃªn chuyáº¿n Ä‘i" required>

		<input type="hidden" name="trip_list_id" value="{{ trip_list.id }}">

		<button type="submit">Táº¡o lá»‹ch trÃ¬nh</button>
	</form>
</div>

<div class="toggle-container" onclick="this.classList.toggle('active')">
  <div class="summary">ğŸ“„ ThÃ´ng tin tá»•ng quÃ¡t (nháº¥p Ä‘á»ƒ má»Ÿ rá»™ng)</div>
  <div class="details">
    <ul>
      <li>Chi tiáº¿t 1: MÃ´ táº£ Ä‘áº§u tiÃªn</li>
      <li>Chi tiáº¿t 2: ThÃ´ng tin tiáº¿p theo</li>
      <li>Chi tiáº¿t 3: Ghi chÃº thÃªm</li>
    </ul>
  </div>
</div>

<script>
	function updateExtraInputsVisibility() {
		// Láº¥y táº¥t cáº£ radio Ä‘ang Ä‘Æ°á»£c chá»n
		const selectedStart = document.querySelector('input[name="start_point"]:checked');
		const selectedEnd = document.querySelector('input[name="end_point"]:checked');

		// Láº¥y ID cá»§a Ä‘á»‹a Ä‘iá»ƒm Ä‘Æ°á»£c chá»n lÃ m start hoáº·c end (cÃ³ thá»ƒ giá»‘ng nhau hoáº·c khÃ¡c)
		const hiddenIds = new Set();
		if (selectedStart) hiddenIds.add(selectedStart.value);
		if (selectedEnd) hiddenIds.add(selectedEnd.value);

		// Láº·p qua táº¥t cáº£ cÃ¡c div extra inputs vÃ  xá»­ lÃ½ hiá»ƒn thá»‹
		document.querySelectorAll('.extra-inputs').forEach(div => {
			const locationId = div.id.replace('extra-inputs-', '');
			if (hiddenIds.has(locationId)) {
				div.style.display = 'none';
			} else {
				div.style.display = 'block';
			}
		});
	}

	// Gáº¯n sá»± kiá»‡n onchange cho radio sau khi DOM Ä‘Ã£ load
	window.addEventListener('DOMContentLoaded', () => {
		// Gá»i láº§n Ä‘áº§u Ä‘á»ƒ xá»­ lÃ½ cÃ¡c radio Ä‘Ã£ chá»n sáºµn
		updateExtraInputsVisibility();

		// Gáº¯n sá»± kiá»‡n cho táº¥t cáº£ cÃ¡c radio
		document.querySelectorAll('input[name="start_point"], input[name="end_point"]').forEach(radio => {
			radio.addEventListener('change', updateExtraInputsVisibility);
		});
	});
</script>


{% else %}
<p>ChÆ°a cÃ³ Ä‘á»‹a Ä‘iá»ƒm nÃ o trong danh sÃ¡ch.</p>
{% endif %}
{% endblock %}